<div class="lab-setup-container">
  <!-- Fixed Header -->
  <div class="lab-header">
    <div class="header-content">
      <h1>Search Doctors</h1>
      <p class="muted-white">Total: {{ totalDoctors }} doctors | Showing: {{ filteredDoctors.length }}</p>
    </div>
    <!-- Subnav / Tabs -->
    <div class="subnav">
      <a (click)="navigateToDocSearchRegistration()" class="active">Search Doctor</a>
      <a (click)="navigateToDocRegistration()">Doctor Registration</a>
    </div>
  </div>

  <!-- Scrollable Content -->
  <div class="grid" style="display: block;">
    <div class="search-container">

      <!-- Search Section -->
      <div class="search-section">
        <div class="search-controls">
          <div class="search-input-group">
            <input #searchInput type="text" [(ngModel)]="searchCriteria.name"
              (input)="onSearchTermChange(searchInput.value)"
              placeholder="Search by name, Doctor ID, contact, or Department..." class="search-input">
          </div>

          <div class="filter-group">
            <select [(ngModel)]="searchCriteria.department" (change)="applyFilters()" class="filter-select">
              <option value="">All Departments</option>
              <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
            </select>
          </div>

          <div class="filter-group">
            <select [(ngModel)]="searchCriteria.gender" (change)="applyFilters()" class="filter-select">
              <option value="">All Genders</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <button type="button" (click)="clearFilters()" class="clear-btn">
            üîÑ Clear
          </button>
        </div>
      </div>

      <!-- Results Table -->
      <div class="results-table">
        <table class="table">
          <thead>
            <tr>
              <th>Sr No</th>
              <th>Date</th>
              <th>Doctor ID</th>
              <th>Doctor Name</th>
              <th>Department</th>
              <th>Gender</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let doctor of filteredDoctors; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ doctor.createdAt | date:'dd/MM/yyyy' }}</td>
              <td>
                <span class="doctor-id">{{ doctor.doctorId || doctor._id }}</span>
              </td>
              <td>{{ getDoctorName(doctor) }}</td>
              <td>{{ getDepartmentName(doctor.department) }}</td>
              <td>{{ doctor.gender }}</td>
              <td>
                <div class="action-buttons">
                  <button (click)="viewDoctor(doctor)" class="btn-view" title="View Details">
                    <i class="fa-solid fa-eye"></i> View
                  </button>
                  <button (click)="editDoctor(doctor)" class="btn-edit" title="Edit Doctor">
                    <i class="fa-solid fa-edit"></i> Edit
                  </button>
                  <button (click)="deleteDoctor(doctor)" class="btn-delete" title="Delete Doctor">
                    <i class="fa-solid fa-trash"></i> Delete
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- No Data Message -->
        <div *ngIf="filteredDoctors.length === 0" class="no-data">
          <div class="no-data-content">
            <span class="no-data-icon">üë®‚Äç‚öïÔ∏è</span>
            <h3 class="no-data-title">No Doctors Found</h3>
            <p class="no-data-text">No doctors match your search criteria.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<app-delete-confirmation-modal [show]="showDeleteConfirmation" [title]="'Delete Doctor'" [message]="deleteMessage"
  [warningText]="'This action cannot be undone'" (confirmed)="confirmDelete()" (cancelled)="cancelDelete()">
</app-delete-confirmation-modal>

<!-- Delete Success Modal -->
<app-delete-success-modal [show]="showDeleteSuccess" [title]="'Doctor Deleted'"
  [message]="'The doctor has been successfully removed from the system.'" [badgeText]="'Operation completed'"
  [autoHideDelay]="2000" (closed)="onDeleteSuccessClosed()">
</app-delete-success-modal>

<!-- Delete Blocked Modal -->
<app-delete-blocked-modal [show]="showDeleteBlocked" [title]="'Cannot Delete Doctor'" [message]="deleteBlockedMessage"
  [details]="deleteBlockedDetails" [badgeText]="'Dependencies present'" [rooms]="blockedRooms" [doctors]="[]"
  [autoHideDelay]="3000" (closed)="closeDeleteBlocked()">
</app-delete-blocked-modal>