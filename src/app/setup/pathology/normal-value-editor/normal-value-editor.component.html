
<div class="normal-value-editor">
  <!-- Modal Header -->
  <div class="modal-header">
    <h4 class="modal-title">Normal value - {{ parameter?.name || 'Parameter' }}</h4>
    <button type="button" class="close-btn" (click)="onClose()">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <form [formGroup]="normalValueForm" (ngSubmit)="onSave()">
    <!-- Type Selection -->
    <div class="type-selection">
      <label class="type-label">Select type</label>
      <div class="select-wrapper">
        <select class="type-select" [value]="selectedType" (change)="onTypeChangeEvent($event)">
          <option value="Numeric range">Numeric range</option>
          <option value="Text">Text</option>
        </select>
        <i class="fa-solid fa-caret-down select-icon"></i>
      </div>
    </div>

    <!-- Normal Value Ranges -->
    <div class="ranges-container" formArrayName="normalValueRanges">
      @if (isNumericRange()) {
        <!-- Data Rows with inline labels -->
        @for (range of normalValueRanges.controls; track $index; let i = $index) {
          <div [formGroupName]="i" class="data-row">
            <!-- Delete Button -->
            <div class="delete-group">
              <button type="button" class="delete-btn" (click)="removeRange(i)">
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>

            <!-- Gender -->
            <div class="field-group">
              <label class="field-label">* Gender</label>
              <select formControlName="gender" class="field-input">
                @for (gender of genderOptions; track gender.value) {
                  <option [value]="gender.value">{{ gender.label }}</option>
                }
              </select>
            </div>

            <!-- Min Age -->
            <div class="field-group">
              <label class="field-label">* Min. age</label>
              <div class="custom-input-group">
                <input type="number" formControlName="minAge" class="age-input" />
                <select formControlName="minAgeUnit" class="age-select">
                  @for (unit of ageUnits; track unit.value) {
                    <option [value]="unit.value">{{ unit.label }}</option>
                  }
                </select>
              </div>
            </div>

            <!-- Max Age -->
            <div class="field-group">
              <label class="field-label">* Max. age</label>
              <div class="custom-input-group">
                <input type="number" formControlName="maxAge" class="age-input" />
                <select formControlName="maxAgeUnit" class="age-select">
                  @for (unit of ageUnits; track unit.value) {
                    <option [value]="unit.value">{{ unit.label }}</option>
                  }
                </select>
              </div>
            </div>

          <!-- Lower Value -->
          <div class="field-group">
            <label class="field-label">* Lower value</label>
            <input type="text" formControlName="lowerValue" class="field-input" />
          </div>

          <!-- Upper Value -->
          <div class="field-group">
            <label class="field-label">* Upper value</label>
            <input type="text" formControlName="upperValue" class="field-input" />
          </div>

          <!-- Display in Report -->
          <div class="field-group">
            <label class="field-label">
              Displayed in report as

            </label>
            <!-- Auto-generated display (read-only) -->
            @if (!isManualEditMode(i)) {
              <div class="auto-display-container">
                <div class="auto-display-value">{{ getAutoGeneratedRange(i) || '-' }}</div>
                <button type="button" class="edit-btn" (click)="enableManualEdit(i)">
                  <i class="fas fa-edit"></i>
                </button>
              </div>
            }

            <!-- Manual input (editable) -->
            @if (isManualEditMode(i)) {
              <div class="manual-input-container">
                <textarea formControlName="displayInReport" class="field-textarea" placeholder="Enter value manually" rows="2"></textarea>
                <button type="button" class="input-delete-btn" (click)="clearDisplayInReport(i)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            }
          </div>

              <!-- Remark (Optional) -->
              <div class="field-group" style="grid-column: 1 / -1;">
                <label class="field-label">Remark (optional)</label>
                <textarea formControlName="remark" class="field-textarea" placeholder="Enter remark to show under this parameter" rows="2"></textarea>
              </div>

          </div>
        }
      <!-- Text Type -->
      @if (isTextType()) {
        <div [formGroupName]="0" class="text-container">
          <textarea formControlName="textValue" class="text-area" placeholder="Enter text value" rows="4"></textarea>
        </div>
        <div [formGroupName]="0" class="field-group" style="grid-column: 1 / -1; margin-top: 8px;">
          <label class="field-label">Remark (optional)</label>
          <textarea formControlName="remark" class="field-textarea" placeholder="Enter remark to show under this parameter" rows="2"></textarea>
        </div>
      }
      }


    </div>

    <!-- Add More Button (Only for Numeric Range) -->
    <!-- Add More Button (Only for Numeric Range) -->
    @if (isNumericRange()) {
      <div class="add-more-section">
        <button type="button" class="add-more-btn" (click)="addMoreRange()">
          <i class="fa-solid fa-circle-plus"></i> Add more
        </button>
      </div>
    }

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button type="submit" class="update-btn">
        <i class="fas fa-check"></i> Update
      </button>
    </div>
  </form>

  <!-- Success Alert -->
  <app-success-alert
    [show]="showAlert"
    [title]="'ðŸŽ‰ Normal Values Updated Successfully!'"
    [message]="alertMessage"
    [badgeText]="'Update Successful'"
    [autoHideDelay]="2000"
    (close)="showAlert = false">
  </app-success-alert>
</div>
