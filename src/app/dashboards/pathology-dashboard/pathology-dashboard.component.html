<!-- Pathology Dashboard Content -->
<div class="pathology-dashboard">

    <!-- Trial Expiry Notification Banner -->
    @if (showTrialBanner) {
      <div class="trial-banner" [class.expired]="isTrialExpired">
        <div class="trial-banner-content">
          <div class="trial-icon">
            @if (isTrialExpired) {
              <i class="fas fa-exclamation-circle"></i>
            } @else {
              <i class="fas fa-clock"></i>
            }
          </div>
          <div class="trial-message">
            @if (isTrialExpired) {
              <strong>⚠️ Your trial has expired!</strong>
              <span>Please subscribe to continue using all features.</span>
            } @else {
              <strong>⏰ Your trial ends in {{ trialDaysLeft }} day{{ trialDaysLeft > 1 ? 's' : '' }}!</strong>
              <span>Subscribe now to continue enjoying all features.</span>
            }
          </div>
          <button class="btn-subscribe" (click)="togglePlansModal()">
            <i class="fas fa-crown"></i> View Plans & Subscribe
          </button>
          <button class="btn-dismiss" (click)="dismissTrialBanner()" title="Dismiss">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    }

    <!-- Subscription Plans Modal -->
    @if (showPlansModal) {
      <div class="plans-modal-overlay" (click)="togglePlansModal()">
        <div class="plans-modal" (click)="$event.stopPropagation()">
          <div class="plans-modal-header">
            <h3>Choose Your Plan</h3>
            <button class="close-btn" (click)="togglePlansModal()">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="plans-modal-body">
            <div class="plans-grid">
              @for (plan of subscriptionPlans; track plan._id) {
                <div class="plan-card" [style.borderColor]="plan.badgeColor">
                  @if (plan.isPopular) {
                    <div class="popular-badge">⭐ Most Popular</div>
                  }
                  @if (plan.offerText) {
                    <div class="offer-badge">{{ plan.offerText }}</div>
                  }
                  <h4>{{ plan.displayName }}</h4>
                  <div class="plan-price">
                    ₹{{ plan.priceMonthly | number }}<span>/month</span>
                  </div>
                  <ul class="plan-features">
                    @for (feature of plan.featureList; track feature) {
                      <li><i class="fas fa-check"></i> {{ feature }}</li>
                    }
                  </ul>
                  <button class="btn-choose-plan" [style.backgroundColor]="plan.badgeColor">
                    Choose {{ plan.displayName }}
                  </button>
                </div>
              }
            </div>
            <p class="contact-note">
              <i class="fas fa-phone"></i> For payment and activation, contact us at <strong>+91 9876543210</strong>
            </p>
          </div>
        </div>
      </div>
    }

    <!-- Header Section with Purple Gradient -->
    <div class="dashboard-header">
      <div class="header-content">
        <div class="header-left">
          <h1 class="dashboard-title">{{ labName }} Dashboard</h1>
          <p class="dashboard-subtitle">Real-time pathology monitoring system</p>
        </div>

        <!-- Date and User Info -->
        <div class="header-right">
          <div class="date-time">
            <div class="date">{{ currentDate | date:'EEEE, MMMM d, y' }}</div>
            <div class="time">{{ currentDate | date:'h:mm a' }}</div>
            <div class="greeting">Good {{ getGreeting() }}</div>
          </div>
          <!-- Profile icon like Admin dashboard -->
          <div class="user-info">
            <span class="user-role">{{ userRole }}</span>
            <a routerLink="/profile" class="profile-icon" title="View Profile">
              <i class="fa-solid fa-user-circle"></i>
            </a>
          </div>
        </div>

        <!-- Animated Heart Section -->
        <div class="heart-section">
          <div class="heart-container">
            <div class="animated-heart">
              <div class="heartbeat-container">
                <!-- Left Blue Heartbeat Line -->
                <div class="heartbeat-line left-line">
                  <svg viewBox="0 0 300 80" class="heartbeat-svg">
                    <path class="heartbeat-path blue-line"
                          d="M0,40 L80,40 L90,20 L100,60 L110,10 L120,70 L130,40 L300,40"
                          stroke="#3b82f6" stroke-width="3" fill="none" />
                  </svg>
                </div>

                <!-- Heart Image -->
                <div class="heart-image">
                </div>

                <!-- Right Pink Heartbeat Line -->
                <div class="heartbeat-line right-line">
                  <svg viewBox="0 0 300 80" class="heartbeat-svg">
                    <path class="heartbeat-path pink-line"
                          d="M0,40 L80,40 L90,20 L100,60 L110,10 L120,70 L130,40 L300,40"
                          stroke="#ff6b9d" stroke-width="3" fill="none" />
                  </svg>
                </div>
              </div>
            </div>

            <!-- User Info Section -->
            <div class="user-info-below">
              <div class="user-name">{{ userRole }}</div>
              <div class="user-status">{{ userName || 'System Administration' }}</div>
            </div>

          </div>
        </div>
      </div>
    </div>
  
  <!-- Statistics Cards Row -->
  <div class="stats-section">
    <div class="stats-grid">
      <!-- Total Registration Card -->
      <div class="stat-card" style="border-left-color: #3b82f6">
        <div class="stat-header">
          <i class="fa-solid fa-clipboard-list stat-icon"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ totalRegistrations }}</h3>
          <p class="stat-title">Total Registration</p>
          <p class="stat-subtitle">Today: {{ todayRegistrations }}</p>
        </div>
      </div>

      <!-- Pending Reports Card -->
      <div class="stat-card" style="border-left-color: #ef4444">
        <div class="stat-header">
          <i class="fa-solid fa-hourglass-half stat-icon"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ totalPendingReports }}</h3>
          <p class="stat-title">Pending Reports</p>
          <p class="stat-subtitle">Today: {{ todayPendingReports }}</p>
        </div>
      </div>

      <!-- Total Reports Card -->
      <div class="stat-card" style="border-left-color: #10b981">
        <div class="stat-header">
          <i class="fa-solid fa-chart-column stat-icon"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ totalReports }}</h3>
          <p class="stat-title">Total Reports</p>
          <p class="stat-subtitle">Today: {{ todayReports }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Dashboard Grid -->
  <div class="dashboard-grid">

    <!-- Left Column -->
    <div class="left-column">

      <!-- Test Trends Chart -->
      <div class="dashboard-card chart-card">
        <div class="card-header">
          <h3><i class="fa-solid fa-chart-line"></i> Weekly Test Trends</h3>
          <div class="chart-controls">
            <button class="chart-btn active">7 Days</button>
            <button class="chart-btn">30 Days</button>
          </div>
        </div>
        <div class="card-content">
          <div class="chart-container">
            <canvas id="pathologyReportsChart"></canvas>
          </div>
          <div class="chart-footer-note">Today Reports: {{ todayReports }}</div>
        </div>
      </div>

      <!-- Calendar Widget -->
      <div class="dashboard-card calendar-card">
        <div class="card-header">
          <h3><i class="fa-solid fa-calendar-days"></i> Hospital Calendar</h3>
          <div class="calendar-date">{{ currentDate | date:'MMMM yyyy' }}</div>
        </div>
        <div class="card-content">
          <div class="calendar-container">
            <div class="calendar-grid">
              <div class="calendar-day-header">Sun</div>
              <div class="calendar-day-header">Mon</div>
              <div class="calendar-day-header">Tue</div>
              <div class="calendar-day-header">Wed</div>
              <div class="calendar-day-header">Thu</div>
              <div class="calendar-day-header">Fri</div>
              <div class="calendar-day-header">Sat</div>

              <!-- Calendar days -->
              <div class="calendar-day" *ngFor="let day of getCalendarDays()"
                   [class.today]="day.isToday"
                   [class.has-events]="day.hasEvents">
                {{ day.date }}
              </div>
            </div>
            <div class="calendar-events">
              <div class="event-item">
                <span class="event-time">09:00 AM</span>
                <span class="event-title">Lab Reports Due</span>
              </div>
              <div class="event-item">
                <span class="event-time">02:00 PM</span>
                <span class="event-title">Equipment Check</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div class="right-column">

      <!-- Quick Actions -->
      <div class="dashboard-card actions-card">
        <div class="card-header">
          <h3><i class="fa-solid fa-bolt"></i> Quick Actions</h3>
        </div>
        <div class="card-content">
          <div class="action-buttons">
            <button class="action-btn primary" (click)="navigateToInvoice()">
              <i class="fa-solid fa-file-invoice action-icon"></i>
              <span class="action-text">New Invoice</span>
            </button>
            <button class="action-btn secondary" (click)="navigateToTestReport()">
              <i class="fa-solid fa-file-medical action-icon"></i>
              <span class="action-text">Generate Report</span>
            </button>
            <button class="action-btn success" (click)="navigateToAllReports()">
              <i class="fa-solid fa-chart-bar action-icon"></i>
              <span class="action-text">View Reports</span>
            </button>
            <button class="action-btn warning" (click)="navigateToReportsRecords()">
              <i class="fa-solid fa-folder-open action-icon"></i>
              <span class="action-text">Reports Records</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Recent Data Table -->
      <div class="dashboard-card recent-data-card">
        <div class="card-header">
          <h3><i class="fa-solid fa-clock-rotate-left"></i> Recent Activity</h3>
          <div class="table-tabs">
            <button class="tab-btn" [class.active]="activeTab === 'registrations'" (click)="setActiveTab('registrations')">
              Today's Registrations
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'reports'" (click)="setActiveTab('reports')">
              Latest Reports
            </button>
          </div>
        </div>
        <div class="card-content">
          <!-- Today's Registrations Tab -->
          <div class="table-container" *ngIf="activeTab === 'registrations'">
            <div class="table-header">
              <span class="table-title">Today's Pathology Registrations ({{ todayRegistrations }})</span>
            </div>
            <div class="data-table" style="max-height: 400px; overflow-y: auto;">
              <div class="table-row header-row">
                <div class="table-cell">S/N</div>
                <div class="table-cell">Patient</div>
                <div class="table-cell">Receipt</div>
                <div class="table-cell">Amount</div>
                <div class="table-cell">Time</div>
              </div>
              <div class="table-row" *ngFor="let registration of recentRegistrations; let i = index">
                <div class="table-cell">{{ i + 1 }}</div>
                <div class="table-cell">
                  <div class="patient-info">
                    <div class="patient-name">{{ registration.patientName }}</div>
                    <div class="patient-details">{{ registration.age }}Y, {{ registration.gender }}</div>
                  </div>
                </div>
                <div class="table-cell">#{{ registration.receiptNumber }}</div>
                <div class="table-cell">₹{{ registration.amount }}</div>
                <div class="table-cell">{{ registration.time }}</div>
              </div>
              <div class="no-data" *ngIf="recentRegistrations.length === 0">
                <span>No registrations today</span>
              </div>
            </div>
          </div>

          <!-- Latest Reports Tab -->
          <div class="table-container" *ngIf="activeTab === 'reports'">
            <div class="table-header">
              <span class="table-title">Latest Generated Reports ({{ recentReports.length }})</span>
            </div>
            <div class="data-table" style="max-height: 400px; overflow-y: auto;">
              <div class="table-row header-row">
                <div class="table-cell">S/N</div>
                <div class="table-cell">Patient</div>
                <div class="table-cell">Lab No</div>
                <div class="table-cell">Status</div>
                <div class="table-cell">Date</div>
              </div>
              <div class="table-row" *ngFor="let report of recentReports; let i = index">
                <div class="table-cell">{{ i + 1 }}</div>
                <div class="table-cell">
                  <div class="patient-info">
                    <div class="patient-name">{{ report.patientName }}</div>
                    <div class="patient-details">{{ report.receiptNo }}</div>
                  </div>
                </div>
                <div class="table-cell">{{ report.labYearlyNo }}</div>
                <div class="table-cell">
                  <span class="status-badge" [style.background-color]="getStatusColor(report.status)">
                    {{ report.status }}
                  </span>
                </div>
                <div class="table-cell">{{ report.reportDate | date:'short' }}</div>
              </div>
              <div class="no-data" *ngIf="recentReports.length === 0">
                <span>No reports generated yet</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
