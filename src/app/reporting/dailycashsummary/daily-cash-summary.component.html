<div class="report-container">
  <!-- Page Title -->
  <div class="page-title">
    <h2>Daily Cash Summary</h2>
  </div>

  <!-- Search Section -->
  <div class="search-section">
    <div class="filter-inputs">
      <!-- Today readonly -->
      <div class="filter-field">
        <label>Today:</label>
        <input type="date" [(ngModel)]="todayDate" name="todayDate" readonly>
      </div>

      <!-- From Date -->
      <div class="filter-field">
        <label>From:</label>
        <input type="date" [(ngModel)]="fromDate" name="fromDate">
      </div>

      <!-- To Date -->
      <div class="filter-field">
        <label>To:</label>
        <input type="date" [(ngModel)]="toDate" name="toDate">
      </div>

      <!-- Month Filter Dropdown -->
      <div class="filter-field">
        <label>Month:</label>
        <select [(ngModel)]="selectedMonth" name="selectedMonth" (change)="onMonthFilterChange()">
          <option value="all">All</option>
          <option value="01">January</option>
          <option value="02">February</option>
          <option value="03">March</option>
          <option value="04">April</option>
          <option value="05">May</option>
          <option value="06">June</option>
          <option value="07">July</option>
          <option value="08">August</option>
          <option value="09">September</option>
          <option value="10">October</option>
          <option value="11">November</option>
          <option value="12">December</option>
        </select>
      </div>

      <!-- Year -->
      <div class="filter-field">
        <label>Year:</label>
        <input type="number" [(ngModel)]="selectedYear" min="2000" max="2100">
      </div>
    </div>

    <div class="action-buttons">
      <button class="download-btn" (click)="downloadPdf()">Download PDF</button>
      <button class="search-btn" (click)="generateReport()">Search</button>
      <button class="print-btn" (click)="printAuto()">Print</button>
    </div>
  </div>

  <!-- Report Content -->
  <div class="report-content" *ngIf="rows.length" id="daily-cash-summary-pdf">
    <div class="report-header">
      <div class="logo-container">
        <img src="./assets/images/myupgov.png" alt="UP Government Logo" class="logo" loading="eager">
      </div>
      <div class="header-text">
        <h1>राजकीय आयुर्वेद महाविद्यालय एवं चिकित्सालय</h1>
        <h2>चौकाघाट, वाराणसी</h2>
        <h3>{{ getReportTitle() }} : {{ getFormattedRangeText() }}</h3>
      </div>
      <div class="logo-spacer"></div>
    </div>

    <!-- Pivot Table: Receipts vs Categories -->
    <div class="report-table">
      <table>
        <thead>
          <tr>
            <th style="min-width: 90px">Receipt No.</th>
            <th *ngFor="let c of categories">{{ c.categoryName }}</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of rows">
            <td>{{ r.receiptNumber }}</td>
            <td *ngFor="let c of categories">
              {{ (r.amountsByCategory[((c.categoryName || '').trim().toUpperCase())] || 0) | number:'1.0-0' }}
            </td>
            <td>{{ r.total | number:'1.0-0' }}</td>
          </tr>
          <tr class="total-row">
            <td>Total</td>
            <td *ngFor="let c of categories">
              {{ (columnTotals[((c.categoryName || '').trim().toUpperCase())] || 0) | number:'1.0-0' }}
            </td>
            <td>{{ grandTotal | number:'1.0-0' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- Signature Footer -->
    <div class="signature-footer">
      <div class="sig-left">
        <div class="line"></div>
        <div class="label">Department Signature</div>
        <div class="small">Name ____________________</div>
        <div class="small">Designation ______________</div>
      </div>
      <div class="sig-right">
        <div class="line"></div>
        <div class="label">Senior Medical Officer</div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <p>Loading report data...</p>
  </div>

  <!-- No Data State -->
  <div class="no-data-container" *ngIf="!rows.length && !isLoading">
    <p>No records found for selected period.</p>
  </div>
</div>

