<!-- Pathology Dashboard Content -->
<div class="pathology-dashboard">
    <!-- Header Section with Purple Gradient -->
    <div class="dashboard-header">
      <div class="header-content">
        <div class="header-left">
          <h1 class="dashboard-title">{{ labName }} Dashboard</h1>
          <p class="dashboard-subtitle">Real-time pathology monitoring system</p>
        </div>

        <!-- Date and User Info -->
        <div class="header-right">
          <div class="date-time">
            <div class="date">{{ currentDate | date:'EEEE, MMMM d, y' }}</div>
            <div class="time">{{ currentDate | date:'h:mm a' }}</div>
            <div class="greeting">Good {{ getGreeting() }}</div>
          </div>
          <!-- <div class="user-info">
            <span class="user-role">Pathology</span>
            <a routerLink="/profile" class="profile-icon" title="View Profile">üë§</a>
          </div> -->
        </div>

        <!-- Animated Heart Section -->
        <div class="heart-section">
          <div class="heart-container">
            <div class="animated-heart">
              <div class="heartbeat-container">
                <!-- Left Blue Heartbeat Line -->
                <div class="heartbeat-line left-line">
                  <svg viewBox="0 0 300 80" class="heartbeat-svg">
                    <path class="heartbeat-path blue-line"
                          d="M0,40 L80,40 L90,20 L100,60 L110,10 L120,70 L130,40 L300,40"
                          stroke="#3b82f6" stroke-width="3" fill="none" />
                  </svg>
                </div>

                <!-- Heart Image -->
                <div class="heart-image">
                </div>

                <!-- Right Pink Heartbeat Line -->
                <div class="heartbeat-line right-line">
                  <svg viewBox="0 0 300 80" class="heartbeat-svg">
                    <path class="heartbeat-path pink-line"
                          d="M0,40 L80,40 L90,20 L100,60 L110,10 L120,70 L130,40 L300,40"
                          stroke="#ff6b9d" stroke-width="3" fill="none" />
                  </svg>
                </div>
              </div>
            </div>

            <!-- User Info Section -->
            <div class="user-info-below">
              <div class="user-name">{{ userRole }}</div>
              <div class="user-status">{{ userName || 'System Administration' }}</div>
              <div class="user-info">
            <a routerLink="/profile" class="profile-icon" title="View Profile">üë§</a>
          </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  
  <!-- Statistics Cards Row - Compact Style -->
  <div class="stats-section">
    <div class="stats-grid-compact">
      <!-- Total Tests Card -->
      <div class="stat-card-compact" style="border-left-color: #3b82f6">
        <i class="fa-solid fa-flask-vial stat-icon-compact"></i>
        <div class="stat-content-compact">
          <h3 class="stat-value-compact">{{ totalTests }}</h3>
          <p class="stat-title-compact">TOTAL TESTS</p>
          <p class="stat-subtitle-compact">+{{ todayTests }} today <i class="fa-solid fa-circle trend-indicator"></i></p>
        </div>
      </div>

      <!-- Total Reports Card -->
      <div class="stat-card-compact" style="border-left-color: #f59e0b">
        <i class="fa-solid fa-chart-column stat-icon-compact"></i>
        <div class="stat-content-compact">
          <h3 class="stat-value-compact">{{ totalReports }}</h3>
          <p class="stat-title-compact">TOTAL REPORTS</p>
          <p class="stat-subtitle-compact">+{{ todayReports }} today <i class="fa-solid fa-circle trend-indicator"></i></p>
        </div>
      </div>

      <!-- Total Registration Card -->
      <div class="stat-card-compact" style="border-left-color: #10b981">
        <i class="fa-solid fa-clipboard-list stat-icon-compact"></i>
        <div class="stat-content-compact">
          <h3 class="stat-value-compact">{{ totalRegistrations }}</h3>
          <p class="stat-title-compact">TOTAL REGISTRATION</p>
          <p class="stat-subtitle-compact">+{{ todayRegistrations }} today <i class="fa-solid fa-circle trend-indicator"></i></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart and Calendar Row -->
  <div class="chart-calendar-section">
    <!-- Daily Test Trends Chart -->
    <div class="dashboard-card chart-card">
      <div class="card-header">
        <h3><i class="fa-solid fa-chart-line"></i> Daily Test Trends</h3>
      </div>
      <div class="card-content">
        <div class="chart-container">
          <canvas id="pathologyReportsChart"></canvas>
        </div>
        <div class="chart-footer-note">Today Reports: {{ todayReports }}</div>
      </div>
    </div>

    <!-- Calendar Widget -->
    <div class="dashboard-card calendar-card">
      <div class="card-header">
        <h3><i class="fa-solid fa-calendar-days"></i> Hospital Calendar</h3>
        <div class="calendar-date">{{ currentDate | date:'MMMM yyyy' }}</div>
      </div>
      <div class="card-content">
        <div class="calendar-container">
          <div class="calendar-grid">
            <div class="calendar-day-header">Sun</div>
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>

            <!-- Calendar days -->
            <div class="calendar-day" *ngFor="let day of getCalendarDays()"
                 [class.today]="day.isToday"
                 [class.has-events]="day.hasEvents">
              {{ day.date }}
            </div>
          </div>
          <div class="calendar-events">
            <div class="event-item">
              <span class="event-time">09:00 AM</span>
              <span class="event-title">Lab Reports Due</span>
            </div>
            <div class="event-item">
              <span class="event-time">02:00 PM</span>
              <span class="event-title">Equipment Check</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions Row -->
  <div class="quick-actions-section">
    <div class="dashboard-card actions-card">
      <div class="card-header">
        <h3><i class="fa-solid fa-chart-pie"></i> Reporting & Analytics</h3>
      </div>
      <div class="card-content">
        <div class="action-buttons">
          <a class="action-btn primary" routerLink="/pathology-module/scheduled-tests">
            <span class="live-pill">LIVE</span>
            <span class="action-count">{{ todayTests }}</span>
            <i class="fa-solid fa-flask action-icon"></i>
            <span class="action-text">Today Tests</span>
          </a>
          <a class="action-btn secondary" routerLink="/pathology-module/registered-report">
            <span class="live-pill">LIVE</span>
            <span class="action-count">{{ todayReports }}</span>
            <i class="fa-solid fa-file-medical action-icon"></i>
            <span class="action-text">Generate Report</span>
          </a>
          <a class="action-btn success" routerLink="/pathology-module/all-reports">
            <span class="live-pill">LIVE</span>
            <span class="action-count">{{ totalReports }}</span>
            <i class="fa-solid fa-chart-bar action-icon"></i>
            <span class="action-text">View Reports</span>
          </a>
          <a class="action-btn warning" routerLink="/pathology-module/reports-records">
            <span class="live-pill">LIVE</span>
            <span class="action-count">{{ totalReports }}</span>
            <i class="fa-solid fa-folder-open action-icon"></i>
            <span class="action-text">Reports Records</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Self Registration / Home Collection Requests -->
  <div class="self-reg-section">
    <div class="dashboard-card self-reg-card">
      <div class="card-header">
        <h3>
          <i class="fa-solid fa-house-medical"></i>
          Home Collection Requests
          <span class="live-indicator pulse">‚óè</span>
        </h3>
        <span class="activity-count home-count">{{ selfRegistrations.length }}</span>
      </div>
      <div class="card-content">
        <div class="self-reg-list" *ngIf="selfRegistrations.length > 0">
          <div class="self-reg-item" *ngFor="let sr of selfRegistrations | slice:0:5; let i = index" [class.new-entry]="i < 2">
            <div class="patient-avatar">
              <span>{{ (sr.firstName?.charAt(0) || 'P') | uppercase }}</span>
            </div>
            <div class="patient-info">
              <div class="patient-name">{{ (sr.firstName || '') + ' ' + (sr.lastName || '') }}</div>
              <div class="patient-details">
                <span class="detail-item">üìû {{ sr.phone || 'N/A' }}</span>
                <span class="detail-item" *ngIf="sr.age">üéÇ {{ sr.age }} yrs</span>
                <span class="detail-item" *ngIf="sr.gender">{{ sr.gender === 'M' ? 'üë®' : sr.gender === 'F' ? 'üë©' : 'üßë' }}</span>
              </div>
              <div class="patient-address" *ngIf="sr.address || sr.city">
                üìç {{ sr.address || '' }} {{ sr.city ? ', ' + sr.city : '' }}
              </div>
              <div class="preferred-time" *ngIf="sr.preferredDate || sr.preferredTime">
                üìÖ {{ sr.preferredDate | date:'dd MMM yyyy' }} {{ sr.preferredTime || '' }}
              </div>
            </div>
            <div class="item-badges">
              <span class="collection-badge home" *ngIf="sr.homeCollection">üè† HOME</span>
              <span class="collection-badge lab" *ngIf="!sr.homeCollection">üè• LAB</span>
              <span class="time-badge">{{ sr.createdAt | date:'h:mm a' }}</span>
              <span class="new-badge" *ngIf="i < 2">NEW</span>
            </div>
          </div>
        </div>
        <div class="no-data" *ngIf="selfRegistrations.length === 0">
          <span class="empty-icon">üì≠</span>
          <span>No pending home collection requests</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Tables Row -->
  <div class="tables-section">
    <!-- Latest Tests Table -->
    <div class="dashboard-card table-card">
      <div class="card-header">
        <h3><i class="fa-solid fa-list-check"></i> Latest Tests ({{ todayRegistrations }})</h3>
      </div>
      <div class="card-content">
        <div class="data-table" style="max-height: 400px; overflow-y: auto;">
          <div class="table-row header-row">
            <div class="table-cell">S/N</div>
            <div class="table-cell">Patient</div>
            <div class="table-cell">Receipt</div>
            <div class="table-cell">Amount</div>
            <div class="table-cell">Time</div>
          </div>
          <div class="table-row" *ngFor="let registration of recentRegistrations; let i = index">
            <div class="table-cell">{{ i + 1 }}</div>
            <div class="table-cell">
              <div class="patient-info">
                <div class="patient-name">{{ registration.patientName }}</div>
                <div class="patient-details">{{ registration.age }}Y, {{ registration.gender }}</div>
              </div>
            </div>
            <div class="table-cell">#{{ registration.receiptNumber }}</div>
            <div class="table-cell">‚Çπ{{ registration.amount }}</div>
            <div class="table-cell">{{ registration.time }}</div>
          </div>
          <div class="no-data" *ngIf="recentRegistrations.length === 0">
            <span>No tests today</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Latest Reports Table -->
    <div class="dashboard-card table-card">
      <div class="card-header">
        <h3><i class="fa-solid fa-file-lines"></i> Latest Reports ({{ recentReports.length }})</h3>
      </div>
      <div class="card-content">
        <div class="data-table" style="max-height: 400px; overflow-y: auto;">
          <div class="table-row header-row">
            <div class="table-cell">S/N</div>
            <div class="table-cell">Patient</div>
            <div class="table-cell">Lab No</div>
            <div class="table-cell">Status</div>
            <div class="table-cell">Date</div>
          </div>
          <div class="table-row" *ngFor="let report of recentReports; let i = index">
            <div class="table-cell">{{ i + 1 }}</div>
            <div class="table-cell">
              <div class="patient-info">
                <div class="patient-name">{{ report.patientName }}</div>
                <div class="patient-details">{{ report.receiptNo }}</div>
              </div>
            </div>
            <div class="table-cell">{{ report.labYearlyNo }}</div>
            <div class="table-cell">
              <span class="status-badge" [style.background-color]="getStatusColor(report.status)">
                {{ report.status }}
              </span>
            </div>
            <div class="table-cell">{{ report.reportDate | date:'short' }}</div>
          </div>
          <div class="no-data" *ngIf="recentReports.length === 0">
            <span>No reports generated yet</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
