<div class="modern-dashboard">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="dashboard-title">{{ labName }} Dashboard</h1>
        <p class="dashboard-subtitle">Welcome back! Here's your hospital overview</p>
      </div>
      <div class="header-right">
        <div class="weather-info" *ngIf="weatherData">
          <div class="weather-temp">{{ weatherData.temperature }}¬∞C {{ weatherData.icon }}</div>
          <div class="weather-condition">{{ weatherData.condition }}</div>
        </div>
        <div class="datetime-info">
          <div class="current-date">{{ currentDateTime.date }}</div>
          <div class="current-time">{{ currentDateTime.time }}</div>
          <div class="greeting">{{ currentDateTime.greeting }}</div>
        </div>
        <div class="user-info">
          <span class="user-name">{{ currentUser?.firstName }} {{ currentUser?.lastName }}</span>
          <span class="user-role">{{ currentUser?.role }}</span>
          <span class="system-admin" *ngIf="currentUser?.role === 'Admin'">System Administration</span>
          <!-- Profile icon near Super Admin text -->
          <a routerLink="/profile" class="profile-icon" title="View Profile">üë§</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Cards Grid -->
  <div class="stats-grid">
    <!-- Patients + OPD (Split Card) -->
    <div class="stat-card patients-opd-split split">
      <div class="stat-content">
        <div class="stat-number">{{ stats.totalPatients }}</div>
        <div class="stat-label">TOTAL PATIENTS</div>
        <div class="stat-change">+{{ stats.todayPatients }} today <span class="live-indicator">üî¥</span></div>
      </div>

      <div class="double-divider" aria-hidden="true"></div>

      <div class="stat-content">
        <div class="stat-number">{{ stats.totalOPD }}</div>
        <div class="stat-label">TOTAL OPD</div>
        <div class="stat-change">+{{ stats.todayOPD }} today <span class="live-indicator">üî¥</span></div>
      </div>
    </div>

    <!-- Registration Card -->
    <div class="stat-card reg-card">
      <div class="stat-content">
        <div class="stat-number">{{ stats.totalRegistrations }}</div>
        <div class="stat-label">TOTAL REGISTRATION</div>
        <div class="stat-change">+{{ stats.todayRegistrations }} today <span class="live-indicator">üî¥</span></div>
      </div>
    </div>

    <!-- IPD Patients Card -->
    <!-- <div class="stat-card ipd-card">
      <div class="stat-icon">
        <span class="icon">üè•</span>
      </div>
      <div class="stat-content">
        <div class="stat-number">{{ stats.ipdPatients }}</div>
        <div class="stat-label">IPD PATIENTS</div>
        <div class="stat-change">Currently admitted</div>
      </div>
    </div> -->

    <!-- Total Revenue + One-Rupee Revenue (split card with double vertical line) -->
    <div class="stat-card earnings-card split">

      <div class="stat-content one-rupee">
        <div class="stat-number">‚Çπ{{ (stats.totalRegistrations || 0) | number }}</div>
        <div class="stat-label">ONE-RUPEE<br> REVENUE</div>
        <div class="stat-change">+‚Çπ{{ (stats.todayRegistrations || 0) | number }} today <span class="live-indicator">üî¥</span></div>
      </div>
      <div class="double-divider" aria-hidden="true"></div>
      <div class="stat-content">
        <div class="stat-number">‚Çπ{{ stats.totalRevenue | number }}</div>
        <div class="stat-label">CASH-RECIEPT<br> REVENUE</div>
        <div class="stat-change">+‚Çπ{{ stats.todayRevenue | number }} today <span class="live-indicator">ÔøΩ</span></div>
      </div>

    </div>

    <!-- Grand Total Revenue Card -->
    <div class="stat-card revenue-card">
      <div class="stat-icon">
        <span class="icon">üí∞</span>
      </div>
      <div class="stat-content">
        <div class="stat-number">‚Çπ{{ ((stats.totalRevenue || 0) + (stats.totalRegistrations || 0)) | number }}</div>
        <div class="stat-label">TOTAL REVENUE</div>
        <div class="stat-change">+‚Çπ{{ ((stats.todayRevenue || 0) + (stats.todayRegistrations || 0)) | number }} today <span class="live-indicator">üî¥</span></div>
      </div>
    </div>



    <!-- Pathology: Reports + Registration (Split Card) -->
    <div class="stat-card pathology-split-card split">

      <div class="stat-content">
        <div class="stat-number">{{ pathologyRegistrations }}</div>
        <div class="stat-label">Total PATHOLOGY REGISTRATION</div>
        <div class="stat-change">+{{ todayPathologyRegistrations }} today <span class="live-indicator">üî¥</span></div>
      </div>

           <div class="double-divider" aria-hidden="true"></div>

       <div class="stat-content">
        <div class="stat-number">{{ stats.labReports || 0 }}</div>
        <div class="stat-label">Total PATHOLOGY REPORTS</div>
        <div class="stat-change">+{{ todayLabReports }} today <span class="live-indicator">üî¥</span></div>
      </div>
    </div>


    <!-- Cash Receipt Patients: OPD + IPD (Split Card) -->
    <!-- <div class="stat-card cash-split-card split">
      <div class="stat-content">
        <div class="stat-number">{{ opdCashReceipts }}</div>
        <div class="stat-label">Total CASH RECEIPT Patient (OPD)</div>
        <div class="stat-change">+{{ todayOpdCashReceipts }} today <span class="live-indicator">üî¥</span></div>
      </div>

      <div class="double-divider" aria-hidden="true"></div>

      <div class="stat-content">
        <div class="stat-number">{{ ipdCashReceipts }}</div>
        <div class="stat-label">Total CASH RECEIPT Patient (IPD)</div>
        <div class="stat-change">+{{ todayIpdCashReceipts }} today <span class="live-indicator">üî¥</span></div>
      </div>
    </div> -->





  </div>

  <!-- Analytics Section -->
  <div class="analytics-section">
    <div class="analytics-grid">
      <!-- Patient Trends Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Total Revenue Trend</h3>
          <div class="chart-controls">
            <button
              class="period-btn"
              [class.active]="trendPeriod === 'daily'"
              (click)="switchTrendPeriod('daily')">
              Daily
            </button>
            <button
              class="period-btn"
              [class.active]="trendPeriod === 'monthly'"
              (click)="switchTrendPeriod('monthly')">
              Monthly
            </button>
            <button
              class="period-btn"
              [class.active]="trendPeriod === 'yearly'"
              (click)="switchTrendPeriod('yearly')">
              Yearly
            </button>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="revenueChart"></canvas>
        </div>
      </div>

      <!-- Calendar Widget -->
      <div class="calendar-card">
        <div class="calendar-header">
          <h3>Hospital Calendar</h3>
          <div class="calendar-date">{{ currentDateTime.date }}</div>
        </div>
        <div class="calendar-container">
          <div class="calendar-grid">
            <div class="calendar-day-header">Sun</div>
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>

            <!-- Calendar days (simplified) -->
            <div class="calendar-day" *ngFor="let day of getCalendarDays()"
                 [class.today]="day.isToday"
                 [class.has-events]="day.hasEvents">
              {{ day.date }}
            </div>
          </div>
          <div class="calendar-events">
            <div class="event-item">
              <span class="event-time">09:00 AM</span>
              <span class="event-title">Staff Meeting</span>
            </div>
            <div class="event-item">
              <span class="event-time">02:00 PM</span>
              <span class="event-title">Department Review</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>



  <!-- Quick Actions Section -->
  <div class="quick-actions-section">
    <div class="section-header">
      <h2 class="section-title">Quick Actions</h2>
      <p class="section-subtitle">Frequently used hospital operations</p>
    </div>


    <div class="quick-actions-grid">
      <!-- Payment Methods Manager -->
      <div class="quick-action-card payment-methods-card">
        <div class="qa-header">
          <h4>Payment Methods</h4>
          <p class="qa-sub">Add or remove accepted payment methods</p>
        </div>
        <div class="qa-body">
          <div class="pm-form">
            <input placeholder="Code (eg: CASH, UPI)" [(ngModel)]="newPaymentMethod.code" />
            <input placeholder="Display name (eg: Cash)" [(ngModel)]="newPaymentMethod.name" />
            <button class="btn" (click)="addPaymentMethod()">Add</button>
          </div>

          <div class="pm-list">
            <div *ngFor="let pm of paymentMethods" class="pm-item">
              <span class="pm-code">{{ pm.code }}</span>
              <span class="pm-name">{{ pm.name }}</span>
              <button class="btn btn-link" (click)="removePaymentMethod(pm.code)">Remove</button>
            </div>
            <div *ngIf="!paymentMethods || paymentMethods.length === 0" class="no-pm">No payment methods configured</div>
          </div>
        </div>
      </div>



    </div>
  </div>

  <!-- Reporting Section -->
  <div class="reporting-section">
    <div class="section-header">
      <h2 class="section-title">üìà Reporting & Analytics</h2>
      <p class="section-subtitle">Generate and view hospital reports</p>
    </div>

    <div class="reporting-grid">
      <div class="report-card" routerLink="/reporting/consolidated-opd-report">
        <div class="report-icon">üìä</div>
        <div class="report-title">Consolidated OPD Report</div>
        <div class="report-subtitle">Department-wise OPD summary</div>
        <div class="report-badge">LIVE</div>
        <div class="report-metric"><span class="label">Total OPD</span><span class="value">{{ stats.totalOPD || 0 }}</span></div>
      </div>

      <div class="report-card" routerLink="/reporting/daily-opd-report">
        <div class="report-icon">üìã</div>
        <div class="report-title">Daily OPD Report</div>
        <div class="report-subtitle">Daily patient statistics</div>
        <div class="report-badge">LIVE</div>
        <div class="report-metric"><span class="label">Today</span><span class="value">{{ stats.todayOPD || 0 }}</span></div>
      </div>

      <div class="report-card" routerLink="/reporting/central-opd-report">
        <div class="report-icon">üóÇÔ∏è</div>
        <div class="report-title">Central OPD Report</div>
        <div class="report-subtitle">Daily list with Yearly/M. No./D. No.</div>
        <div class="report-badge">NEW</div>
        <div class="report-metric"><span class="label">Today</span><span class="value">{{ stats.todayOPD || 0 }}</span></div>
      </div>


      <div class="report-card" routerLink="/reporting/daily-cash-report">
        <div class="report-icon">üí∞</div>
        <div class="report-title">Daily Cash Report</div>
        <div class="report-subtitle">Department-wise cash collection</div>
        <div class="report-badge">LIVE</div>
        <div class="report-metric"><span class="label">Today</span><span class="value">‚Çπ{{ (stats.todayRevenue || 0) | number }}</span></div>
      </div>

      <div class="report-card" routerLink="/reporting/monthly-opd-report">
        <div class="report-icon">üìà</div>
        <div class="report-title">Monthly OPD Report</div>
        <div class="report-subtitle">Monthly analytics & trends</div>
        <div class="report-badge">LIVE</div>
        <div class="report-metric"><span class="label">This Month</span><span class="value">{{ stats.monthlyPatients || 0 }}</span></div>
      </div>
    </div>
  </div>

  <!-- Recent Activity Section -->
  <div class="recent-activity-section">
    <div class="section-header">
      <h2 class="section-title">Recent Activity</h2>
      <p class="section-subtitle">Latest hospital activities</p>
    </div>

    <div class="activity-grid">
      <!-- Today's Logins -->
      <div class="activity-card">
        <div class="activity-header">
          <h3>Today's Logins <span class="live-indicator">üü¢ LIVE</span></h3>
          <span class="activity-count">{{ todayLogins.length }}</span>
        </div>
        <div class="activity-list users">
          <div class="user-activity-item" *ngFor="let u of todayLogins | slice:0:6">
            <div class="ua-left">
              <div class="ua-avatar" [class.placeholder]="!u.profilePicture">
                <img *ngIf="u.profilePicture" [src]="u.profilePicture" alt="" />
                <span *ngIf="!u.profilePicture">{{ (u.name && u.name.length ? u.name[0] : 'U') | uppercase }}</span>
              </div>
              <div class="ua-meta">
                <div class="ua-name">{{ u.name }} <span class="ua-role">{{ u.role }}</span></div>
                <div class="ua-email">{{ u.email }}</div>
              </div>
            </div>
            <div class="ua-right">
              <div class="ua-time">Login: {{ u.loginTime }}</div>
              <div class="ua-duration">Usage: {{ u.durationLabel }}</div>
            </div>
          </div>
          <div class="no-data" *ngIf="todayLogins.length === 0">
            <span>No logins yet today</span>
          </div>
        </div>
      </div>

      <!-- Today's Patients (Receipt edits) -->
      <div class="activity-card">
        <div class="activity-header">
          <h3>Today's Edit Patients Records <span class="live-indicator">üî¥ LIVE</span></h3>
          <span class="activity-count">{{ todayReceiptEdits.length }}</span>
        </div>
        <div class="activity-list">
          <div class="activity-item" *ngFor="let e of todayReceiptEdits | slice:0:6; let i = index">
            <span class="activity-time">{{ e.time }}</span>
            <span class="activity-text">{{ e.patient }} ‚Ä¢ #{{ e.receiptNumber }}</span>
            <span [class.delta-pos]="e.delta > 0" [class.delta-neg]="e.delta < 0" class="delta">
              {{ e.delta > 0 ? '+' : (e.delta < 0 ? '-' : '') }}‚Çπ{{ (e.delta > 0 ? e.delta : (e.delta < 0 ? -e.delta : 0)) | number }}
            </span>
          </div>
          <div class="no-data" *ngIf="todayReceiptEdits.length === 0">
            <span>No receipts edited today</span>
          </div>
        </div>
      </div>





      <!-- Revenue Summary - Hidden until actual billing data is available -->
      <!--
      <div class="activity-card">
        <div class="activity-header">
          <h3>Revenue Summary</h3>
          <span class="activity-amount">‚Çπ{{ getTotalRevenue() | number }}</span>
        </div>
        <div class="revenue-breakdown">
          <div class="revenue-item">
            <span class="revenue-label">OPD Consultations</span>
            <span class="revenue-value">‚Çπ{{ (stats.todayRevenue * 0.6) | number:'1.0-0' }}</span>
          </div>
          <div class="revenue-item">
            <span class="revenue-label">Lab Tests</span>
            <span class="revenue-value">‚Çπ{{ stats.labRevenue | number }}</span>
          </div>
          <div class="revenue-item">
            <span class="revenue-label">Pharmacy</span>
            <span class="revenue-value">‚Çπ{{ stats.pharmacyRevenue | number }}</span>
          </div>
        </div>
      </div>
      -->
    </div>
  </div>
</div>
