<div class="plans-management">
  <div class="page-header">
    <div>
      <h2><i class="fas fa-tags"></i> Plans Management</h2>
      <p class="subtitle">Manage subscription plans, pricing, and offers</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline" (click)="seedDefaultPlans()">
        <i class="fas fa-sync-alt"></i> Reset to Default
      </button>
      <button class="btn btn-primary" (click)="openAddPlan()">
        <i class="fas fa-plus"></i> Add New Plan
      </button>
    </div>
  </div>

  <!-- Success/Error Messages -->
  <div class="alert alert-success" *ngIf="successMessage">
    <i class="fas fa-check-circle"></i> {{ successMessage }}
  </div>
  <div class="alert alert-danger" *ngIf="error">
    <i class="fas fa-exclamation-circle"></i> {{ error }}
    <button class="close-btn" (click)="error = ''">&times;</button>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="loading">
    <i class="fas fa-spinner fa-spin"></i> Loading plans...
  </div>

  <!-- Plans Grid -->
  <div class="plans-grid" *ngIf="!loading">
    <div class="plan-card" *ngFor="let plan of plans" [class.inactive]="!plan.isActive"
         [style.borderColor]="plan.badgeColor">
      <div class="plan-badge" *ngIf="plan.isPopular">⭐ Popular</div>
      <div class="plan-status" [class.active]="plan.isActive">
        {{ plan.isActive ? 'Active' : 'Inactive' }}
      </div>
      
      <div class="plan-header" [style.borderBottomColor]="plan.badgeColor">
        <h3>{{ plan.displayName }}</h3>
        <div class="plan-price">
          <span class="currency">₹</span>{{ plan.priceMonthly | number }}
          <span class="period">/month</span>
        </div>
        <div class="yearly-price" *ngIf="plan.priceYearly > 0">
          ₹{{ plan.priceYearly | number }}/year
        </div>
      </div>

      <div class="plan-offer" *ngIf="plan.offerText">
        <i class="fas fa-gift"></i> {{ plan.offerText }}
        <span *ngIf="plan.discountPercent > 0">({{ plan.discountPercent }}% off)</span>
      </div>

      <div class="plan-details">
        <p class="description">{{ plan.description }}</p>
        <div class="trial-info" *ngIf="plan.trialDays > 0">
          <i class="fas fa-clock"></i> {{ plan.trialDays }} Days Trial
        </div>
      </div>

      <ul class="feature-list">
        <li *ngFor="let feature of plan.featureList">
          <i class="fas fa-check"></i> {{ feature }}
        </li>
      </ul>

      <div class="plan-actions">
        <button class="btn btn-sm btn-edit" (click)="editPlan(plan)">
          <i class="fas fa-edit"></i> Edit
        </button>
        <button class="btn btn-sm" [class.btn-success]="!plan.isActive" [class.btn-warning]="plan.isActive"
                (click)="toggleActive(plan)">
          <i class="fas" [class.fa-eye]="!plan.isActive" [class.fa-eye-slash]="plan.isActive"></i>
          {{ plan.isActive ? 'Deactivate' : 'Activate' }}
        </button>
        <button class="btn btn-sm btn-danger" (click)="deletePlan(plan)">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && plans.length === 0">
    <i class="fas fa-box-open"></i>
    <p>No plans found. Click "Add New Plan" or "Reset to Default" to get started.</p>
  </div>
</div>

<!-- Edit Modal -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ isNewPlan ? 'Add New Plan' : 'Edit Plan' }}</h3>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Plan Name (ID)</label>
          <input type="text" [(ngModel)]="editingPlan.planName" [disabled]="!isNewPlan" placeholder="e.g., basic">
        </div>
        <div class="form-group">
          <label>Display Name</label>
          <input type="text" [(ngModel)]="editingPlan.displayName" placeholder="e.g., Basic Plan">
        </div>
      </div>

      <div class="form-group">
        <label>Description</label>
        <input type="text" [(ngModel)]="editingPlan.description" placeholder="Brief description">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Monthly Price (₹)</label>
          <input type="number" [(ngModel)]="editingPlan.priceMonthly" min="0">
        </div>
        <div class="form-group">
          <label>Yearly Price (₹)</label>
          <input type="number" [(ngModel)]="editingPlan.priceYearly" min="0">
        </div>
        <div class="form-group">
          <label>Trial Days</label>
          <input type="number" [(ngModel)]="editingPlan.trialDays" min="0">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Discount %</label>
          <input type="number" [(ngModel)]="editingPlan.discountPercent" min="0" max="100">
        </div>
        <div class="form-group">
          <label>Offer Text</label>
          <input type="text" [(ngModel)]="editingPlan.offerText" placeholder="e.g., Limited Time Offer!">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Badge Color</label>
          <input type="color" [(ngModel)]="editingPlan.badgeColor">
        </div>
        <div class="form-group">
          <label>Sort Order</label>
          <input type="number" [(ngModel)]="editingPlan.sortOrder" min="0">
        </div>
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" [(ngModel)]="editingPlan.isPopular"> Mark as Popular
          </label>
        </div>
      </div>

      <div class="form-group">
        <label>Features</label>
        <div class="features-input">
          <input type="text" [(ngModel)]="newFeature" placeholder="Add a feature" (keyup.enter)="addFeature()">
          <button class="btn btn-sm btn-primary" (click)="addFeature()">Add</button>
        </div>
        <ul class="features-list">
          <li *ngFor="let feature of editingPlan.featureList; let i = index">
            {{ feature }}
            <button class="remove-btn" (click)="removeFeature(i)">&times;</button>
          </li>
        </ul>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-outline" (click)="closeModal()">Cancel</button>
      <button class="btn btn-primary" (click)="savePlan()">
        <i class="fas fa-save"></i> {{ isNewPlan ? 'Create Plan' : 'Save Changes' }}
      </button>
    </div>
  </div>
</div>

