<div class="super-admin-dashboard">
  <!-- Header -->
  <div class="dashboard-header">
    <h1><i class="fas fa-shield-alt"></i> Super Admin Dashboard</h1>
    <p>Multi-Lab Management System</p>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-hospital"></i></div>
      <div class="stat-content">
        <h3>{{ stats.totalLabs }}</h3>
        <p>Total Labs</p>
      </div>
    </div>

    <div class="stat-card pending">
      <div class="stat-icon"><i class="fas fa-clock"></i></div>
      <div class="stat-content">
        <h3>{{ stats.pendingApprovals }}</h3>
        <p>Pending Approvals</p>
      </div>
    </div>

    <div class="stat-card active">
      <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
      <div class="stat-content">
        <h3>{{ stats.activeLabs }}</h3>
        <p>Active Labs</p>
      </div>
    </div>

    <div class="stat-card trial">
      <div class="stat-icon"><i class="fas fa-gift"></i></div>
      <div class="stat-content">
        <h3>{{ stats.trialLabs }}</h3>
        <p>Trial Plans</p>
      </div>
    </div>

    <div class="stat-card basic">
      <div class="stat-icon"><i class="fas fa-box"></i></div>
      <div class="stat-content">
        <h3>{{ stats.basicLabs }}</h3>
        <p>Basic Plans</p>
      </div>
    </div>

    <div class="stat-card premium">
      <div class="stat-icon"><i class="fas fa-crown"></i></div>
      <div class="stat-content">
        <h3>{{ stats.premiumLabs }}</h3>
        <p>Premium Plans</p>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <label>Status:</label>
      <select [(ngModel)]="filterStatus" (change)="onFilterChange()" class="filter-select">
        <option value="all">All Status</option>
        <option value="pending">Pending</option>
        <option value="approved">Approved</option>
        <option value="rejected">Rejected</option>
      </select>
    </div>

    <div class="filter-group">
      <label>Plan:</label>
      <select [(ngModel)]="filterPlan" (change)="onFilterChange()" class="filter-select">
        <option value="all">All Plans</option>
        <option value="trial">Trial</option>
        <option value="basic">Basic</option>
        <option value="premium">Premium</option>
      </select>
    </div>

    <div class="filter-group search-group">
      <label>Search:</label>
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (input)="onFilterChange()"
        placeholder="Search by name, code, email, city..."
        class="search-input"
      >
    </div>

    <button (click)="loadDashboardData()" class="btn-refresh">
      <i class="fas fa-sync-alt"></i> Refresh
    </button>

    <button (click)="toggleViewMode()" class="btn-view-toggle">
      <i [class]="viewMode === 'table' ? 'fas fa-th-large' : 'fas fa-table'"></i>
      {{ viewMode === 'table' ? 'Card View' : 'Table View' }}
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <p><i class="fas fa-spinner fa-spin"></i> Loading labs...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-alert">
    <p><i class="fas fa-exclamation-triangle"></i> {{ error }}</p>
  </div>

  <!-- Card View -->
  <div *ngIf="!loading && !error && viewMode === 'cards'" class="labs-cards-container">
    <div class="labs-grid">
      <div *ngFor="let lab of filteredLabs" class="lab-card">
        <!-- Profile Picture Section -->
        <div class="lab-card-header">
          <div class="lab-avatar">
            <img
              *ngIf="getAdminProfilePicture(lab)"
              [src]="getAdminProfilePicture(lab)"
              [alt]="lab.labName"
              class="avatar-img"
            />
            <div *ngIf="!getAdminProfilePicture(lab)" class="avatar-placeholder">
              {{ getAdminInitials(lab) }}
            </div>
          </div>
        </div>

        <!-- Lab Info -->
        <div class="lab-card-body">
          <h3 class="lab-name">{{ lab.labName }}</h3>
          <p class="lab-location"><i class="fas fa-map-marker-alt"></i> {{ lab.city }}, {{ lab.state }}</p>

          <!-- View More Button -->
          <button class="btn-view-more" (click)="viewLabProfile(lab._id)">
            <i class="fas fa-eye"></i> View More
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredLabs.length === 0" class="empty-state">
      <p><i class="fas fa-inbox"></i> No labs found matching your filters.</p>
    </div>
  </div>

  <!-- Labs Table -->
  <div *ngIf="!loading && !error && viewMode === 'table'" class="labs-table-container">
    <table class="labs-table">
      <thead>
        <tr>
          <th>Lab Code</th>
          <th>Lab Name</th>
          <th>Email</th>
          <th>Location</th>
          <th>Plan</th>
          <th>Status</th>
          <th>Trial Ends</th>
          <th>Stats</th>
          <th>Registered</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let lab of filteredLabs" [class.trial-expiring]="isTrialExpiring(lab)" (click)="viewLabProfile(lab._id)" style="cursor: pointer;">
          <td><strong>{{ lab.labCode }}</strong></td>
          <td>{{ lab.labName }}</td>
          <td>{{ lab.email }}</td>
          <td>{{ lab.city }}, {{ lab.state }}</td>
          <td>
            <span class="badge" [ngClass]="getPlanBadgeClass(lab.subscriptionPlan)">
              {{ lab.subscriptionPlan | uppercase }}
            </span>
          </td>
          <td>
            <span class="badge" [ngClass]="getStatusBadgeClass(lab.approvalStatus)">
              {{ lab.approvalStatus | uppercase }}
            </span>
          </td>
          <td>
            <span *ngIf="lab.subscriptionPlan === 'trial'">
              {{ formatDate(lab.trialEndsAt || '') }}
              <span *ngIf="isTrialExpiring(lab)" class="expiring-badge">
                <i class="fas fa-exclamation-triangle"></i> {{ getDaysLeft(lab.trialEndsAt || '') }}d left
              </span>
            </span>
            <span *ngIf="lab.subscriptionPlan !== 'trial'">-</span>
          </td>
          <td>
            <div class="lab-stats">
              <span title="Users"><i class="fas fa-users"></i> {{ lab.totalUsers }}</span>
              <span title="Patients"><i class="fas fa-user-injured"></i> {{ lab.totalPatients }}</span>
              <span title="Reports"><i class="fas fa-file-medical"></i> {{ lab.totalReports }}</span>
            </div>
          </td>
          <td>{{ formatDate(lab.createdAt) }}</td>
          <td (click)="$event.stopPropagation()">
            <div class="action-buttons">
              <button
                *ngIf="lab.approvalStatus === 'pending'"
                (click)="approveLab(lab._id); $event.stopPropagation()"
                class="btn-approve"
                title="Approve Lab"
              >
                <i class="fas fa-check"></i> Approve
              </button>
              <button
                *ngIf="lab.approvalStatus === 'pending'"
                (click)="rejectLab(lab._id); $event.stopPropagation()"
                class="btn-reject"
                title="Reject Lab"
              >
                <i class="fas fa-times"></i> Reject
              </button>
              <span *ngIf="lab.approvalStatus !== 'pending'" class="no-action">
                -
              </span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div *ngIf="filteredLabs.length === 0" class="empty-state">
      <p><i class="fas fa-inbox"></i> No labs found matching your filters.</p>
    </div>
  </div>
</div>
